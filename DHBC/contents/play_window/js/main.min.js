bc = bc || {},
  function () {
    function g(n) {
      for (var r, u = "", f = i.split("").reverse().join(""), t = 0; t < n.length; t++) r = i.indexOf(n.charAt(t)), u += r >= 0 ? f.charAt(r) : n.charAt(t);
      return u.replace(/aas/ig, "ấ").replace(/aaf/ig, "ầ").replace(/aar/ig, "ẩ").replace(/aax/ig, "ẫ").replace(/aaj/ig, "ậ").replace(/aa/ig, "â").replace(/as/ig, "á").replace(/af/ig, "à").replace(/ar/ig, "ả").replace(/ax/ig, "ã").replace(/aj/ig, "ạ").replace(/aws/ig, "ắ").replace(/awf/ig, "ằ").replace(/awr/ig, "ẳ").replace(/awx/ig, "ẵ").replace(/awj/ig, "ặ").replace(/aw/ig, "ă").replace(/ees/ig, "ế").replace(/eef/ig, "ề").replace(/eer/ig, "ể").replace(/eex/ig, "ễ").replace(/eej/ig, "ệ").replace(/ee/ig, "ê").replace(/es/ig, "é").replace(/ef/ig, "è").replace(/er/ig, "ẻ").replace(/ex/ig, "ẽ").replace(/ej/ig, "ẹ").replace(/oos/ig, "ố").replace(/oof/ig, "ồ").replace(/oor/ig, "ổ").replace(/oox/ig, "ỗ").replace(/ooj/ig, "ộ").replace(/oo/ig, "ô").replace(/os/ig, "ó").replace(/of/ig, "ò").replace(/or/ig, "ỏ").replace(/ox/ig, "õ").replace(/oj/ig, "ọ").replace(/is/ig, "í").replace(/if/ig, "ì").replace(/ir/ig, "ỉ").replace(/ix/ig, "ĩ").replace(/ij/ig, "ị").replace(/ows/ig, "ớ").replace(/owf/ig, "ờ").replace(/owr/ig, "ở").replace(/owx/ig, "ỡ").replace(/owj/ig, "ợ").replace(/ow/ig, "ơ").replace(/ys/ig, "ý").replace(/yf/ig, "ỳ").replace(/yr/ig, "ỷ").replace(/yx/ig, "ỹ").replace(/yj/ig, "ỵ").replace(/us/ig, "ú").replace(/uf/ig, "ù").replace(/ur/ig, "ủ").replace(/ux/ig, "ũ").replace(/uj/ig, "ụ").replace(/uws/ig, "ứ").replace(/uwf/ig, "ừ").replace(/uwr/ig, "ử").replace(/uwx/ig, "ữ").replace(/uwj/ig, "ự").replace(/uw/ig, "ư").replace(/dd/ig, "đ").replace(/-+/ig, " ").toLowerCase()
    }

    function o(n) {
      return n.replace(/[áàảãạâấầẩẫậăắằẳẵặ]/ig, "a").replace(/[đ]/ig, "d").replace(/[éèẻẽẹêếềểễệ]/ig, "e").replace(/[íìỉĩị]/ig, "i").replace(/[óòỏõọôốồổỗộơớờởỡợ]/ig, "o").replace(/[ýỳỷỹỵ]/ig, "y").replace(/[úùủũụưứừửữự]/ig, "u").replace(/\s+/ig, "").toLowerCase()
    }

    function s(n) {
      for (var i, r, t = n.length; t; i = Math.floor(Math.random() * t), r = n[--t], n[t] = n[i], n[i] = r);
      return n
    }

    function v(n) {
      n = n.toLowerCase().replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
      var i = new RegExp("[\\?&]" + n + "=([^&#]*)"),
        t = i.exec(location.search.toLowerCase());
      return t == null ? "" : decodeURIComponent(t[1].replace(/\+/g, " "))
    }

    function l(n, t) {
      return (new RC4).encrypt(n + "", t)
    }

    function u(n, t) {
      return (new RC4).decrypt(n + "", t)
    }

    function r() {
      return n && $.isNumeric(n.l) ? parseInt(n.l) : 1
    }

    function h() {
      return n && $.isNumeric(n.sound) ? parseInt(n.sound) : 1
    }

    function y(t) {
      $.isNumeric(t) && (n.sound = t, t == 1 ? $("#start.stage .btn-speaker").removeClass("off") : $("#start.stage .btn-speaker").addClass("off"))
    }

    function f() {
      if (n && n.s) {
        var t = u(n.s, i);
        return $.isNumeric(t) ? parseInt(t) : 0
      }
      return 0
    }

    function p(t) {
      $.isNumeric(t) && (n.s = l(t, i), $("#play.stage .header .points>i").text(t))
    }

    function c() {
      if (n && n.p) {
        var t = u(n.p, i);
        return $.isNumeric(t) ? parseInt(t) : 0
      }
      return 0
    }

    function nt(t) {
      $.isNumeric(t) && (n.p = l(t, i))
    }

    function tt(t) {
      $.isNumeric(t) && (n.l = t)
    }

    function _control(n) {
      $(".stage").addClass("hide");
      $("#" + n).removeClass("hide");
      switch (n) {
        case "play":
          play();
          break;
        case "result":
          result();
          break;
        case "start":
          start();
          break;
        case "gameover":
          gameover();
          break;
        case "savescore":
          savescore();
          break;
        case "share":
          share();
      }
    }

    function ut() {
      $("#play.stage .share").click(function () {
        _control("share")
      });
      $("#play.stage .hint").click(st);
      $("#start.stage .btn-speaker").click(ft);
      $(".button.btn-share").click(ot);
      $(".button.btn-replay").click(function () {
        ct()
      });
      $(".button.btn-continue").click(function () {
        _control("play")
      });
      $(".button.btn-start").click(function () {
        _control("play")
      });
      $.isNumeric(v("gid") + "") ? $(".button.btn-save").click(function () {
        _control("savescore")
      }) : $(".button.btn-save").click(function () {
        _control("savescore")
      });
      $(".dialog  .btn-close,#share  .btn-close").click(function () {
        _control("play")
      });
      $("#abackhome").click(function () {
        _control("start")
      });
      bc.welcome && $("#start.stage .welcome").html(bc.welcome);
      h() == 1 ? $("#start.stage .btn-speaker").removeClass("off") : $("#start.stage .btn-speaker").addClass("off")
    }

    function ft() {
      h() == 1 ? y(0) : y(1)
    }

    function share() {
      $("#share #shareImage").attr("src", $("#image").attr("src"))
    }

    function ot() {
      _control("play");
      html2canvas(document.getElementById("stages"), {
        onrendered: function (n) {
          var t = $("#share textarea.comment").val();
          postCanvasToFacebook(n, t)
        }
      })
    }

    function st() {
      var t = 20,
        u = f(),
        i, n;
      if (u >= t) {
        if (confirm("Mở một ô đáp án bạn sẽ mất " + t + " Xu.\nBạn có chắc chắn không?")) {
          var s = w() + 1,
            h = r(),
            c = e(bc.data[h - 1]),
            l = o(c.d);
          for (p(u - t), b(s), i = $("#play.stage .answer>a"), $("#play.stage .keyboard>a").css("visibility", ""), i.text("").off("mousedown"), n = 0; n < s; n++) $($("#play.stage .keyboard>a:contains('" + l[n] + "')")[0]).trigger("mousedown"), $(i[n]).addClass("disabled").off("mousedown")
        }
      } else alert("Bạn không có đủ " + t + " xu để mua gợi ý")
    }

    function w() {
      return n && $.isNumeric(n.h) ? parseInt(n.h) : 0
    }

    function b(t) {
      $.isNumeric(t) && (n.h = t)
    }

    function savescore() {
    }

    function ct() {
      n.h = "";
      n.l = "";
      n.s = "";
      n.p = "";
      _control("start")
    }

    function lt() {
      var n = r(),
        t;
      return n <= bc.data.length && (t = e(bc.data[n - 1]), $("#play.stage .answer>a").text().toLowerCase() == o(t.d)) ? !0 : !1
    }

    function e(n) {
      var t = n.split(".")[0];
      return {
        a: n,
        d: g(t)
      }
    }

    function at() {
      $("#play.stage .answer").addClass("wrong");
      setTimeout(function () {
        $("#play.stage .answer").removeClass("wrong")
      }, 2e3);
      h() == 1 && rt.play()
    }

    function vt() {
      $("#play.stage .answer").addClass("correct");
      setTimeout(function () {
        $("#play.stage .answer").removeClass("correct");
        nt(c() + 40 + f() * 3);
        p(f() + 4);
        b(0);
        _control("result");
        tt(r() + 1)
      }, 2e3)
    }

    function start() { }

    function gameover() { }

    function play() {
      var p = "assets/pics/",
        c = 14,
        u = r(),
        h, n, l, v, b, y, i, d;
      if ($("#play.stage .keyboard").empty(), $("#play.stage .answer").empty(), u <= bc.data.length) {
        if (h = e(bc.data[u - 1]), n = s(o(h.d).split("")), c < n.length && (c = n.length), $.each(n, function () {
          $("#play.stage .answer").append("<a><\/a>")
        }), l = s(n.concat(s(k).slice(0, c - n.length))), $.each(l, function (n) {
          var t = $("<a><\/a>").text(l[n]).on("mousedown", function () {
            var n = $(this),
              t = $("#play.stage .answer>a");
            t.each(function () {
              if ($(this).text() == "") {
                n.css("visibility", "hidden");
                $(this).text(n.text()).one("mousedown", function () {
                  $(this).text("");
                  n.css("visibility", "")
                });
                return t.text().replace(" ", "").length == t.length && (lt() ? vt() : at()), !1
              }
            })
          });
          $("#play.stage .keyboard").append(t)
        }), $("#play.stage .header .level>i").text(r()), $("#play.stage .header .points>i").text(f()), $("#play.stage .body #image").attr("src", p + h.a), v = w(), b = o(h.d), v > 0)
          for (y = $("#play.stage .answer>a"), y.trigger("mousedown"), i = 0; i < v; i++) $($("#play.stage .keyboard>a:contains('" + b[i] + "')")[0]).trigger("mousedown"), $(y[i]).addClass("disabled").off("mousedown")
      } else _control("gameover");
      u < bc.data.length && (d = e(bc.data[u]), a = new Image, a.src = p + d.a)
    }

    function result() {
      var n, i;
      $("#result.stage .letter").empty();
      n = r();
      n <= bc.data.length ? ($("#result.stage .status>h1").text(s(d)[0]), i = e(bc.data[n - 1]), $("#result.stage .letter").text(i.d), $("#result .result .showpoints").html("Điểm: <i>" + c() + "<\/i><br/>xu: <i>" + f() + "<\/i>"), h() == 1 && it.play()) : _control("gameover")
    }

    var i = "abcdeghiklmnopqrstuvxy",
      k = i.split(""),
      d = "Chúc mừng, Xuất sắc, Tuyệt đỉnh, Siêu nhân, Hoan hô, Quá giỏi, Tuyệt cú mèo".split(", "),
      a = new Image,
      n = localStorage || {},
      it = new Howl({
        urls: ["assets/sounds/correct.mp3"]
      }),
      rt = new Howl({
        urls: ["assets/sounds/wrong.mp3"]
      });
    $(function () {
      ut()
    })
  }();
  
RC4 = function () {
  function u(t) {
    for (var u = 0, f, e = t.length, r = 0; r <= 255; r++) i[r] = t[r % e], n[r] = r;
    for (r = 0; r <= 255; r++) u = (u + n[r] + i[r]) % 256, f = n[r], n[r] = n[u], n[u] = f
  }

  function r(t, i) {
    var e, l;
    u(i);
    var r = 0,
      f = 0,
      o = [],
      s, h, c;
    for (e = 0; e < t.length; e++) r = (r + 1) % 256, f = (f + n[r]) % 256, h = n[r], n[r] = n[f], n[f] = h, l = (n[r] + n[f]) % 256, s = n[l], c = t[e] ^ s, o.push(c);
    return o
  }

  function f(n) {
    for (var i = "", r = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"], t = 0; t < n.length; t++) i += r[n[t] >> 4] + r[n[t] & 15];
    return i
  }

  function e(n) {
    for (var i = [], t = n.substr(0, 2) == "0x" ? 2 : 0; t < n.length; t += 2) i.push(parseInt(n.substr(t, 2), 16));
    return i
  }

  function o(n) {
    for (var i = "", t = 0; t < n.length; t++) i += String.fromCharCode(n[t]);
    return i
  }

  function _control(n) {
    for (var i = [], t = 0; t < n.length; t++) i.push(n.charCodeAt(t));
    return i
  }
  var n = [], i = [];
  this.encrypt = function (n, i) {
    var u = _control(n),
      e = _control(i),
      o = r(u, e);
    return f(o)
  };
  this.decrypt = function (n, i) {
    var u = e(n),
      f = _control(i),
      s = r(u, f);
    return o(s)
  }
};